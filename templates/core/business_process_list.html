{% extends 'base.html' %}

{% block title %}–ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã - RiskMap{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">üìä –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã</h1>
        <div class="btn-group">
            <a href="{% url 'core:process_create' %}" class="btn btn-success">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
            </a>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ -->
    {% if processes %}
        <div class="row">
            {% for process in processes %}
            <div class="col-lg-6 col-xl-4 mb-4">
                <div class="card shadow h-100">
                    <div class="card-body">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">{{ process.name }}</h5>
                            <span class="badge bg-{% if process.criticality == 'critical' %}danger{% elif process.criticality == 'high' %}warning{% else %}info{% endif %}">
                                {{ process.get_criticality_display }}
                            </span>
                        </div>

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <p class="card-text text-muted">
                            {% if process.description %}
                                {{ process.description|truncatewords:15 }}
                            {% else %}
                                <em>–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è</em>
                            {% endif %}
                        </p>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                        <div class="mb-3">
                            <small class="text-muted d-block">
                                <i class="fas fa-bug"></i> –£—è–∑–≤–∏–º–æ—Å—Ç–µ–π: <strong>{{ process.vulnerability_count }}</strong>
                            </small>
                            <small class="text-muted d-block">
                                <i class="fas fa-chart-line"></i> –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: 
                                <strong>
                                    {% if process.risk_score >= 80 %}
                                        <span class="text-danger">üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π</span>
                                    {% elif process.risk_score >= 60 %}
                                        <span class="text-warning">üü† –í—ã—Å–æ–∫–∏–π</span>
                                    {% elif process.risk_score >= 40 %}
                                        <span class="text-info">üü° –°—Ä–µ–¥–Ω–∏–π</span>
                                    {% else %}
                                        <span class="text-success">üü¢ –ù–∏–∑–∫–∏–π</span>
                                    {% endif %}
                                </strong>
                            </small>
                            <small class="text-muted d-block">
                                <i class="fas fa-calendar"></i> –°–æ–∑–¥–∞–Ω: {{ process.created_at|date:"d.m.Y" }}
                            </small>
                        </div>

                        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Ä–∏—Å–∫–∞ -->
                        <div class="progress mb-3" style="height: 8px;">
                            <div 
                                class="progress-bar {% if process.risk_score >= 80 %}bg-danger{% elif process.risk_score >= 60 %}bg-warning{% elif process.risk_score >= 40 %}bg-info{% else %}bg-success{% endif %}" 
                                style="width: {{ process.risk_score }}%"
                            ></div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                        <div class="btn-group btn-group-sm w-100" role="group">
                            <a href="{% url 'core:process_detail' process.pk %}" class="btn btn-outline-primary">
                                <i class="fas fa-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                            <a href="{% url 'core:process_edit' process.pk %}" class="btn btn-outline-warning">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </a>
                            <a href="{% url 'core:process_delete' process.pk %}" class="btn btn-outline-danger">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="card text-center p-5">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üì≠</div>
            <h3>–ù–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</h3>
            <p class="text-muted mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞.</p>
            <a href="{% url 'core:process_create' %}" class="btn btn-primary btn-lg">
                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
